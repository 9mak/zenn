---
title: "[AWS] スポットインスタンス：コスト効率とパフォーマンスのバランス"
emoji: "💆"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS","EC2"]
published: true
publication_name: "ap_com"
---

スポットインスタンスって知っていますか？

AWSのスポットインスタンスっていうサービスを利用することで、大量のコンピューティングリソースを低コストで利用できます。

```
・ EC2インスタンスのコストが高い
・ 大量のコンピューティングリソースが必要だが、予算が限られている
・ リソースの使用率を最大化したいけど方法がわからない
```

今回は👆を解決するためのナレッジについて共有です。
スポットインスタンスの基本的な概念、使用例、注意点まで解説していきます！<br>

## スポットインスタンスとは何か？
- **なんなのか？**
  - スポットインスタンスはAmazon Web Services (AWS) の Elastic Compute Cloud (EC2) サービスの一部で、オンデマンドインスタンスよりも大幅に低いコストで利用できるコンピューティングリソースです。
  - AWSがリアルタイムで価格を設定しその価格がユーザーの入札価格を上回った場合、またはAWSがそのリソースを必要とした場合に、スポットインスタンスは中断されます。

- **何ができるか？**
  - スポットインスタンスは、大量のコンピューティングリソースが必要ながらも開始と終了の時間が柔軟なタスクに適しています（勝手に終了されたりするから
  - 例えば、大規模なデータ分析、バッチ処理、テスト環境などに利用することができます。

- **特徴**
  - スポットインスタンスはオンデマンドインスタンスに比べて大幅にコストを削減できます。しかし、AWSによって中断される可能性があるため、中断が許容できるワークロードにのみ使用することが推奨されます。
  - スポットインスタンスは、市場価格に基づいて価格が変動します。ユーザーはスポットインスタンスをリクエストする際に、支払いたい最高価格を入札として提出します。

:::message alert
**スポットインスタンスは中断されます**の部分デメリットなのであとで説明します
:::

## スポットインスタンスのコスト効率性
スポットインスタンスを利用することで、コンピューティングコストを大幅に削減することが可能です。<br>
その具体的な方法と実際のコスト削減の例を紹介します。

### スポットインスタンスによるコスト削減
スポットインスタンスは、オンデマンドインスタンスと比較して大幅に低い価格で提供されてます。<br>
AWS側が未使用のコンピューティングリソースを有効活用するための戦略の一部(妄想)で、ユーザーにとっては大きなコスト削減の機会となります。<br>
具体的には、スポットインスタンスの価格はオンデマンド価格の10%〜20%程度となることが多いです。

:::message
実際の作成画面でオンデマンドとの料金削減率が見れるので
テンション上がります😎
画像は**77%削減！！！**
![](/images/aws-spot-instances-guide/instance_price.png)
:::

### 実際のコスト削減の例
例えば、大規模なデータ分析を行う場合、通常のオンデマンドインスタンスを使用すると高額なコストが発生しますが！<br>

スポットインスタンスを使用することで同じ分析を大幅に低いコストで行うことが可能になります。<br>

また、開発やテスト環境など**中断が許容される**ワークロードにスポットインスタンスを利用することで、さらなるコスト削減を実現できます。

## スポットインスタンスの使用例
スポットインスタンスは、さまざまなワークロードに適用できます。<br>
このセクションでは、具体的な使用例をいくつか紹介します。

### 分散コンピューティング
科学的なシミュレーションや複雑な計算を行うアプリケーションでは、大量のコンピューティングリソースが必要となります。<br>
スポットインスタンスを使用することで、これらのタスクを低コストで実行することが可能になります。<br>
また、分散コンピューティングフレームワーク（例：Apache Hadoop, Apache Sparkなど）と組み合わせて使用することも可能です。

:::message
**分散コンピューティング**
プログラムの個々の部分が同時並行的に複数のコンピュータ上で実行され、各々がネットワークを介して互いに通信を行いながら全体として処理が進行する計算手法のことである。
参照：wikipedia(https://ja.wikipedia.org/wiki/%E5%88%86%E6%95%A3%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)
:::

### ウェブサーバー
スポットインスタンスは、トラフィックの予測が難しいウェブサーバーにも適しています。<br>
需要が高まるピーク時に追加のスポットインスタンスを利用することで、需要に応じてスケールアウトすることができます。

### バッチ処理
時間がかかるバッチ処理は、スポットインスタンスの利用に最適です。<br>
スポットインスタンスを使用することで、大量のデータを効率的に処理することができ、コストも大幅に削減できます。

:::message
**バッチ処理**
一定期間データを集め、複数の処理をある程度まとめて一括処理を行う方式のこと。また、一連のタスクをスケジューリングしておき、自動的に連続処理を行う方式。
出典：[用語集｜バッチ処理
](https://www.idcf.jp/words/batch-processing.html)
:::

## スポットインスタンスの注意点
スポットインスタンスを利用する際には、いくつかの注意点があります。いいことだけではないんです😢<br>

このセクションでは、それらの注意点とベストプラクティスについて説明します。

### スポットインスタンスの終了
スポットインスタンスは、市場価格がユーザーの入札価格を上回ると、AWSによっていつでも終了される可能性があります。<br>
そのため、スポットインスタンスを使用する際には、ジョブが中断されても問題ないような設計が必要です。

スポットインスタンスは、以下の2つのシナリオで終了されます：

1. **AWSがそのリソースを必要とした場合**：AWSがそのリソースをオンデマンドの需要に対応するために必要とした場合、スポットインスタンスは終了されます。

2. **スポット価格がユーザーの入札価格を上回った場合**：スポットインスタンスの価格はリアルタイムで変動します。ユーザーはスポットインスタンスをリクエストする際に、支払いたい最高価格を入札として提出しますが、この入札価格をスポット価格が上回った場合、スポットインスタンスは終了されます。

スポットインスタンスが終了される前に、**AWSは2分間の通知**を提供します。<br>

この通知は、EC2インスタンスメタデータとAmazon CloudWatchイベントの両方で利用できるので、例えばこの通知を利用して必要なクリーンアップ作業を行ったり、作業の途中経過を保存したりすることができます。

ただし、スポットインスタンスが終了されるとそのインスタンスで実行されていた作業は失われます。

### ベストプラクティス
スポットインスタンスを最大限に活用するためには、以下のようなベストプラクティスを実践することが推奨されます。

- **スポットインスタンスの価格変動を監視する**：スポットインスタンスの価格は市場の供給と需要によって変動するため、価格の変動を定期的に監視し、適切な入札価格を設定することが大事です。
- **中断されても問題ないワークロードに使用する**：スポットインスタンスはいつでも終了される可能性があるため、中断されても問題ないワークロードに使わないことが推奨されます。
- **スポットインスタンスとオンデマンドインスタンスを組み合わせる**：スポットインスタンスとオンデマンドインスタンスを組み合わせることで、コスト効率と信頼性を両立することが可能。

## まとめ
AWSのスポットインスタンスは、コスト効率を最大化しながら、パワフルなコンピューティングリソースを活用するための秘密兵器です。<br>

## 参考リソース
スポットインスタンスについてさらに学びたい人は、以下のリソースを参照してください。

- [AWS公式ドキュメンテーション](https://aws.amazon.com/jp/ec2/spot/)
- [AWSスポットインスタンスのベストプラクティス](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/spot-best-practices.html)


ここまでの内容が理解できたら以下もわかりやすいと思います。
実際の通知やデメリットの対策をしてみてください！
- [AWSでゲームサーバーを最大90%安く利用する方法](https://logmi.jp/tech/articles/321685)